import{d as he,ar as me,bm as xe,A as _,r as ge,bn as r,bo as v,bp as $,a9 as o,aa as S,by as Q,bq as g,bu as b,bz as W,h as m,bC as X,a4 as F,bs as U,br as j,bw as Ce}from"../../../../common/preload-helper.MbJrn6NK.js";import{u as we}from"../../../../common/settings-store.Cbib97lz.js";import{g as Y,l as Z,_ as ee,p as Se,s as te}from"../../index.tLNRCOMK.js";import je from"./DnDDataTableControl.BYSfy5Ur.js";import{_ as Oe}from"../../../../common/DataTableControl.vue_vue_type_script_setup_true_lang.C8srsbB4.js";import{B}from"../../../../common/index.Czwl5sZ6.js";import{A as Ve}from"../../../../common/index.BXIJUhvo.js";/* empty css                                                                                                 */import{_ as Ae}from"../../../../common/_plugin-vue_export-helper.DlAUqK2U.js";import"../../../../common/DnDDataTableControl.vue_vue_type_style_index_0_scoped_0b913e4f_lang.eX2WFSeF.js";import"../../../../common/EditOutlined.VR04dkax.js";import"../../../../common/DeleteOutlined.CAxl1b0H.js";import"../../../../common/index.Bv9uIW4S.js";import"../../../../common/index.CWcnEAWt.js";import"../../../../common/motion.BZoznnMR.js";import"../../../../common/useMergedState.DqLXzNX-.js";import"../../../../common/KeyCode.D63Tfrq7.js";import"../../../../common/ActionButton.DsxKi5D_.js";import"../../../../common/GroupEditFields.vue_vue_type_script_setup_true_lang.CIBdtRhe.js";import"../../../../common/index.MUyNM7cG.js";import"../../../../common/FormItemContext.TWH3AZ29.js";import"../../../../common/createContext.CBuT94fL.js";import"../../../../common/statusUtils.hi8hBXOR.js";import"../../../../common/SearchOutlined.U3k4CZZU.js";import"../../../../common/compact-item.BAehxMOj.js";import"../../../../common/index.DsKKLVBC.js";import"../../../../common/isPlainObject.BTsYe1De.js";import"../../../../common/index.DdAGYCH2.js";import"../../../../common/index.v1Yeogkc.js";import"../../../../common/pickAttrs.XR8iodhj.js";import"../../../../common/slide.NKZUR-XG.js";import"../../../../common/isMobile.DycClExL.js";import"../../../../common/useState.C6kRbBbh.js";import"../../../../common/DownOutlined.C9z76A46.js";import"../../../../common/index.BYijhHfN.js";import"../../../../common/index.BeQ9sRPc.js";import"../../../../common/index.BV4b1aO_.js";import"../../../../common/warning.Dss1f44C.js";import"../../../../common/index.CLzt3JGh.js";import"../../../../common/index.bTx3QRbX.js";import"../../../../common/index.7YnrZg9y.js";import"../../../../common/Checkbox.BMnPZ7oJ.js";import"../../../../common/index.CDQlDi1o.js";import"../../../../common/debounce.DjXLyD6P.js";const Fe=["id"],Ue={key:0},Be={class:"data-table-buttons"},Te={key:1,class:"data-table"},Ie={key:2,class:"data-table"},Ke=["innerHTML"],Ne=he({__name:"GroupConditionalControl",props:{params:{type:Object,required:!0},conditionalValues:{type:Object,required:!1,default:()=>({})}},emits:["input","fieldData","selectedCondition","conditionalData","selectedDependent","fieldUpdatedData","fieldUpdatedPopupData","updateDataSource"],setup(le,{emit:ne}){var P,z,J;const ae=le,{params:de}=me(ae),ie=we(),{editedRowKey:x,selectedConditionKey:T,selectedConditionValue:I,openDrawer:O,dynamicOptions:oe,groupData:y}=xe(ie),K=ne,s=de.value,ue=s.classes,D=s.id,u=_(s.fields),re=window.lodash.cloneDeep(u),c=ge({fields:u.value}),f=_(s.table.data),fe=s.group_action,se=(P=s.table)==null?void 0:P.edit_action,N=_((J=(z=s.table)==null?void 0:z.inline_edit)!=null?J:!0),k=_(!1),i=_([]),V=_([]),A=_(""),C=_(""),pe=_("right");if(typeof y.value<"u"&&Object.keys(y.value).length>0&&typeof y.value[D]<"u"&&(f.value=y.value[D]),c.fields)for(const[n,e]of Object.entries(c.fields)){const t=e;i.value[t.id]=t.default}const q=n=>{Object.entries(n).forEach(([e,t])=>{i.value[e]=t})};typeof u.value<"u"&&u.value!==null&&(c.fields=u.value.filter(n=>typeof n.hide<"u"&&n.hide!==null?!n.hide:!0));const G=n=>{let e="",t="";for(const[a,l]of Object.entries(n)){let d=l;e=a,t=d}c.fields=u.value.filter(a=>{if(typeof a.condition<"u"&&a.condition!==null){const l=a.condition.find(d=>d.key===e);return l.value==="yes"&&t==="yes"?!0:l.value==="no"&&t==="no"}else return!0}),V.value[e]=t},ce=n=>{Object.assign(f.value.filter(e=>n.key===e.key)[0],n),y.value[D]=f.value},L=n=>{O.value=!0,x.value=n.key,i.value=n,A.value=n!=null&&n.field_name?n.field_name:"",C.value=n!=null&&n.field_description?n.field_description:"",T.value="",I.value="",c.fields=u.value.filter(e=>{if(typeof n[e.id]<"u"&&n[e.id]!==null){const t=u.value.find(a=>a.id===e.id);if(typeof n.disabled_field<"u"&&n.disabled_field.includes(e.id))return!1;if(typeof t.condition<"u"&&t.condition!==null){const a=t.condition.find(l=>Array.isArray(l.value)&&l.value.includes(n[l.key])?l.value.includes(n[l.key]):l.value===n[l.key]);if(typeof a<"u"&&a!==null){let l=n[e.id];return typeof e.prefix<"u"&&e.prefix!==null&&(l=l.replace(e.prefix,"")),e.default=l,typeof t.dependent_option<"u"&&t.dependent_option!==null&&(oe.value[t.dependent_option]=n[t.dependent_option]),!0}else return!1}else{let a=n[e.id];return typeof e.prefix<"u"&&e.prefix!==null&&(a=a.replace(e.prefix,"")),e.default=a,typeof e.disable_edit<"u"&&e.disable_edit&&(e.disabled=e.disable_edit),!0}}else if(typeof n.additional_fields<"u"&&typeof n.additional_fields[e.id]<"u"){if(typeof n.disabled_field<"u"&&n.disabled_field.includes(e.id))return!1;{let t=n.additional_fields[e.id];return typeof e.prefix<"u"&&e.prefix!==null&&(t=t.replace(e.prefix,"")),e.default=t,typeof e.disable_edit<"u"&&e.disable_edit&&(e.disabled=e.disable_edit),!0}}else return!1})},R=n=>{f.value=f.value.filter(e=>e.key!==n),y.value[D]=f.value},E=n=>{let e="",t="";for(const[a,l]of Object.entries(n)){let d=l;e=a,t=d}c.fields=u.value.filter(a=>{const l=u.value.find(d=>d.id===a.id);if(l)if(typeof l.condition<"u"&&l.condition!==null){const d=l.condition.find(p=>p.key===e);return typeof d<"u"&&d.key===e&&(!Array.isArray(d.value)&&d.value===t||Array.isArray(d.value)&&d.value.includes(t))?(typeof i.value[l.id]<"u"&&i.value[l.id]!==null&&(a.default=i.value[l.id]),typeof l.dependent_option<"u"&&l.dependent_option!==null&&(a.default=l.dependent_default),!0):!1}else return typeof i.value[l.id]<"u"&&i.value[l.id]!==null&&(a.default=i.value[l.id]),typeof l.dependent_option<"u"&&l.dependent_option!==null&&(a.default=l.dependent_default),!0;else return!1})},H=n=>{c.fields=u.value.filter(e=>{const t=u.value.find(a=>a.id===e.id);return t?typeof t.hide<"u"&&t.hide!==null&&t.hide?!1:(typeof i.value[t.id]<"u"&&i.value[t.id]!==null&&(e.default=i.value[t.id]),typeof t.dependent_option<"u"&&t.dependent_option!==null&&(e.default=t.dependent_default),!0):!1})},ve=async()=>{k.value=!0;const n=[{key:"action",value:fe}],e={};let t=0;if(f.value.length>0){let a=f.value.map(d=>d.key);t=Math.max(...a)+1}for(const[a,l]of Object.entries(i.value)){let d=l;typeof l=="object"&&l!==null&&(d=JSON.stringify(l)),n.push({key:a,value:d});let p=l;const h=u.value.find(ke=>ke.id===a);typeof h<"u"&&typeof h.prefix<"u"&&(p=h.prefix+l),e[a]=p}e.key=t,e.field_order=0,delete e.deletetable,delete e.disabled_field,delete e.field_description;try{await te(n)==="success"&&(f.value.push(e),y.value[D]=f.value,T.value="",I.value="",N.value||K("fieldUpdatedData",e)),k.value=!1}catch(a){console.error(a)}finally{k.value=!1,M()}},w=()=>{O.value=!1,x.value=null,M()},ye=async()=>{k.value=!0;const n=[{key:"action",value:se}],e={};for(const[t,a]of Object.entries(i.value)){let l=a;typeof a=="object"&&a!==null&&(l=JSON.stringify(a)),n.push({key:t,value:l});let d=a;const p=u.value.find(h=>h.id===t);if(typeof p<"u"&&typeof p.prefix<"u")if(typeof p.exclude_prefix<"u"&&Array.isArray(p.exclude_prefix)&&p.exclude_prefix.includes(a))d=a;else{const h=l.replace(p.prefix,"");d=p.prefix+h}e[t]=d}try{await te(n)==="success"&&(A.value="",Object.assign(f.value.filter(a=>e.key===a.key)[0],e),y.value[D]=f.value,w(),N.value||K("fieldUpdatedData",e)),k.value=!1}catch(t){}finally{k.value=!1,w()}},_e=n=>{y.value[D]=n},M=()=>{c.fields=u.value.filter(n=>{const e=re.value.find(a=>a.id===n.id);let t="";return typeof e.default<"u"&&e.default!==null&&(t=e.default),n.default=t,typeof e.disable_edit<"u"&&e.disable_edit&&(n.disabled=!1),i.value[e.id]=t,typeof e.hide<"u"&&e.hide!==null?!e.hide:!0})},be=Y("cancelButtonText",wp.i18n.__("Cancel","woocommerce-wholesale-prices")),De=Y("saveButtonText",wp.i18n.__("Update Item","woocommerce-wholesale-prices"));return(n,e)=>{var t;return r(),v(S,null,[$("div",{id:o(D),class:Ce(o(ue))},[o(x)===null?(r(),v("div",Ue,[(r(!0),v(S,null,Q(c.fields,(a,l)=>(r(),v("div",{key:l},[(r(),g(X,null,{fallback:b(()=>[m(ee)]),default:b(()=>[(r(),g(W(o(Z)(a.type)),{params:a,"conditional-values":V.value,onFieldData:q,onConditionalData:G,onSelectedCondition:E,onSelectedDependent:H},null,40,["params","conditional-values"]))]),_:2},1024))]))),128)),$("div",Be,[o(s).button_label!==""?(r(),g(o(B),{key:0,type:"primary",class:"save-group-btn",loading:k.value,onClick:ve},{default:b(()=>[F(U(o(s).button_label),1)]),_:1},8,["loading"])):j("",!0)])])):j("",!0),(t=o(s).table)!=null&&t.drag_and_drop?(r(),v("div",Te,[m(je,{params:o(s).table,data:f.value,"edit-fields":u.value,"edited-fields":o(x),onFieldUpdatedData:L,onFieldDeletedData:R,onUpdateDataSource:_e},null,8,["params","data","edit-fields","edited-fields"])])):(r(),v("div",Ie,[m(Oe,{params:o(s).table,data:f.value,"edit-fields":u.value,onFieldUpdatedData:ce,onFieldUpdatedPopupData:L,onFieldDeletedData:R},null,8,["params","data","edit-fields"])]))],10,Fe),m(o(Ve),{width:600,title:A.value,placement:pe.value,open:o(O),onClose:w},{extra:b(()=>[m(o(B),{style:{"margin-right":"8px"},onClick:w},{default:b(()=>[F(U(o(be)),1)]),_:1}),m(o(B),{type:"primary",loading:k.value,onClick:ye},{default:b(()=>[F(U(o(De)),1)]),_:1},8,["loading"])]),default:b(()=>{var a;return[o(x)!==null?(r(),v(S,{key:0},[C.value!==""?(r(),v("div",{key:0,class:"wwp-drawer-description",innerHTML:o(Se)(((a=C.value)==null?void 0:a.length)>0?C.value:"")},null,8,Ke)):j("",!0),(r(!0),v(S,null,Q(c.fields,(l,d)=>(r(),v("div",{key:d},[(r(),g(X,null,{fallback:b(()=>[m(ee)]),default:b(()=>[(r(),g(W(o(Z)(l.type)),{params:l,"conditional-values":V.value,onFieldData:q,onConditionalData:G,onSelectedCondition:E,onSelectedDependent:H},null,40,["params","conditional-values"]))]),_:2},1024))]))),128))],64)):j("",!0)]}),_:1},8,["title","placement","open"])],64)}}}),Ot=Ae(Ne,[["__scopeId","data-v-96558d5e"]]);export{Ot as default};
