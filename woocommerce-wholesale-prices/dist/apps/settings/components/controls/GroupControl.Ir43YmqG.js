import{d as M,ar as P,bm as H,A as v,r as Q,bn as m,bo as k,aa as W,by as X,bq as D,bu as h,bz as Y,a9 as p,h as V,bC as Z,bp as O,a4 as ee,bs as te,br as ne,bw as ae}from"../../../../common/preload-helper.MbJrn6NK.js";import{u as oe}from"../../../../common/settings-store.Cbib97lz.js";import{l as le,_ as ie,s as de}from"../../index.tLNRCOMK.js";import{_ as se}from"../../../../common/DataTableControl.vue_vue_type_script_setup_true_lang.C8srsbB4.js";import{B as ue}from"../../../../common/index.Czwl5sZ6.js";/* empty css                                                                                      */import{_ as re}from"../../../../common/_plugin-vue_export-helper.DlAUqK2U.js";import"../../../../common/GroupEditFields.vue_vue_type_script_setup_true_lang.CIBdtRhe.js";import"../../../../common/index.MUyNM7cG.js";import"../../../../common/FormItemContext.TWH3AZ29.js";import"../../../../common/createContext.CBuT94fL.js";import"../../../../common/statusUtils.hi8hBXOR.js";import"../../../../common/motion.BZoznnMR.js";import"../../../../common/SearchOutlined.U3k4CZZU.js";import"../../../../common/compact-item.BAehxMOj.js";import"../../../../common/index.DsKKLVBC.js";import"../../../../common/isPlainObject.BTsYe1De.js";import"../../../../common/index.DdAGYCH2.js";import"../../../../common/index.v1Yeogkc.js";import"../../../../common/KeyCode.D63Tfrq7.js";import"../../../../common/pickAttrs.XR8iodhj.js";import"../../../../common/slide.NKZUR-XG.js";import"../../../../common/isMobile.DycClExL.js";import"../../../../common/useMergedState.DqLXzNX-.js";import"../../../../common/useState.C6kRbBbh.js";import"../../../../common/DownOutlined.C9z76A46.js";import"../../../../common/index.BYijhHfN.js";import"../../../../common/index.BeQ9sRPc.js";import"../../../../common/index.BV4b1aO_.js";import"../../../../common/warning.Dss1f44C.js";import"../../../../common/index.Bv9uIW4S.js";import"../../../../common/index.CWcnEAWt.js";import"../../../../common/ActionButton.DsxKi5D_.js";import"../../../../common/EditOutlined.VR04dkax.js";import"../../../../common/DeleteOutlined.CAxl1b0H.js";import"../../../../common/index.CLzt3JGh.js";import"../../../../common/index.bTx3QRbX.js";import"../../../../common/index.7YnrZg9y.js";import"../../../../common/Checkbox.BMnPZ7oJ.js";import"../../../../common/index.CDQlDi1o.js";import"../../../../common/debounce.DjXLyD6P.js";const fe=["id"],pe={class:"data-table-buttons"},ce={class:"data-table"},ve=M({__name:"GroupControl",props:{params:{type:Object,required:!0},conditionalValues:{type:Object,required:!1,default:()=>({})}},emits:["input","fieldData","selectedCondition","conditionalData","selectedDependent","fieldUpdatedData","fieldUpdatedPopupData"],setup(S,{emit:x}){var C,j;const A=S,{params:B}=P(A),F=oe(),{selectedConditionKey:I,selectedConditionValue:K,groupData:r}=H(F),N=x,u=B.value,U=u.classes,c=u.id,d=v(u.fields),f=Q({fields:d.value}),s=v(u.table.data),q=u.group_action,w=v((j=(C=u.table)==null?void 0:C.inline_edit)!=null?j:!0),y=v(!1),l=v([]),g=v([]);if(typeof r.value<"u"&&Object.keys(r.value).length>0&&typeof r.value[c]<"u"&&(s.value=r.value[c]),f.fields)for(const[o,a]of Object.entries(f.fields)){const t=a;l.value[t.id]=t.default}const E=o=>{Object.entries(o).forEach(([a,t])=>{l.value[a]=t})};typeof d.value<"u"&&d.value!==null&&(f.fields=d.value.filter(o=>typeof o.hide<"u"&&o.hide!==null?!o.hide:!0));const G=o=>{let a="",t="";for(const[n,e]of Object.entries(o)){let i=e;a=n,t=i}f.fields=d.value.filter(n=>{if(typeof n.condition<"u"&&n.condition!==null){const e=n.condition.find(i=>i.key===a);return e.value==="yes"&&t==="yes"?!0:e.value==="no"&&t==="no"}else return!0}),g.value[a]=t},R=o=>{Object.assign(s.value.filter(a=>o.key===a.key)[0],o),r.value[c]=s.value},z=o=>{s.value=s.value.filter(a=>a.key!==o),r.value[c]=s.value},L=o=>{let a="",t="";for(const[n,e]of Object.entries(o)){let i=e;a=n,t=i}f.fields=d.value.filter(n=>{const e=d.value.find(i=>i.id===n.id);if(e)if(typeof e.condition<"u"&&e.condition!==null){const i=e.condition.find(_=>_.key===a);return typeof i<"u"&&i.key===a&&(!Array.isArray(i.value)&&i.value===t||Array.isArray(i.value)&&i.value.includes(t))?(typeof l.value[e.id]<"u"&&l.value[e.id]!==null&&(n.default=l.value[e.id]),typeof e.dependent_option<"u"&&e.dependent_option!==null&&(n.default=e.dependent_default),!0):!1}else return typeof l.value[e.id]<"u"&&l.value[e.id]!==null&&(n.default=l.value[e.id]),typeof e.dependent_option<"u"&&e.dependent_option!==null&&(n.default=e.dependent_default),!0;else return!1})},T=o=>{f.fields=d.value.filter(a=>{const t=d.value.find(n=>n.id===a.id);return t?typeof t.hide<"u"&&t.hide!==null&&t.hide?!1:(typeof l.value[t.id]<"u"&&l.value[t.id]!==null&&(a.default=l.value[t.id]),typeof t.dependent_option<"u"&&t.dependent_option!==null&&(a.default=t.dependent_default),!0):!1})},$=async()=>{y.value=!0;const o=[{key:"action",value:q}],a={};let t=0;if(s.value.length>0){let n=s.value.map(i=>i.key);t=Math.max(...n)+1}a.key=t;for(const[n,e]of Object.entries(l.value)){let i=e;typeof e=="object"&&e!==null&&(i=JSON.stringify(e)),o.push({key:n,value:i});let _=e;const b=d.value.find(J=>J.id===n);typeof b<"u"&&typeof b.prefix<"u"&&(_=b.prefix+e),a[n]=_}l.value=[];try{await de(o)==="success"&&(s.value.push(a),r.value[c]=s.value,I.value="",K.value="",w.value||N("fieldUpdatedData",a)),y.value=!1}catch(n){console.error(n)}finally{y.value=!1}};return(o,a)=>(m(),k("div",{id:p(c),class:ae(p(U))},[(m(!0),k(W,null,X(f.fields,(t,n)=>(m(),k("div",{key:n},[(m(),D(Z,null,{fallback:h(()=>[V(ie)]),default:h(()=>[(m(),D(Y(p(le)(t.type)),{params:t,"conditional-values":g.value,onFieldData:E,onConditionalData:G,onSelectedCondition:L,onSelectedDependent:T},null,40,["params","conditional-values"]))]),_:2},1024))]))),128)),O("div",pe,[p(u).button_label!==""?(m(),D(p(ue),{key:0,type:"primary",class:"save-group-btn",loading:y.value,onClick:$},{default:h(()=>[ee(te(p(u).button_label),1)]),_:1},8,["loading"])):ne("",!0)]),O("div",ce,[V(se,{params:p(u).table,data:s.value,"edit-fields":d.value,onFieldUpdatedData:R,onFieldDeletedData:z},null,8,["params","data","edit-fields"])])],10,fe))}}),nt=re(ve,[["__scopeId","data-v-ac0e52be"]]);export{nt as default};
